<!doctype html><html lang=en><head><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Shaleen Jain - DLNA/UPNP casting support in VLC - Part 2
</title><meta content="DLNA renderers, mainly TVâ€™s are DLNA certified devices that are able to play
any media from the local network and is built upon the UPnP A/V Architecture technology.
This allows you to cast any video or audio from any other device to your connected TV." name=description><meta content="upnp, dlna, upnp/dlna, dlna/upnp, vlc, casting, stream, media, media renderer, renderer, dlna renderer" name=keywords><meta content="Shaleen Jain" name=author><link href=https://twitter.com/shalzzj rel=author><link href=https://shaleenjain.com/blog/vlc-dlna-support-2/ rel=canonical><link href=https://shaleenjain.com/atom.xml rel=alternate title=RSS type=application/atom+xml><meta content=@shalzzj name=twitter:site><meta content=@shalzzj name=twitter:creator><meta content=article property=og:type><meta content=https://shaleenjain.com/blog/vlc-dlna-support-2/ property=og:url><meta content="DLNA renderers, mainly TVâ€™s are DLNA certified devices that are able to play
any media from the local network and is built upon the UPnP A/V Architecture technology.
This allows you to cast any video or audio from any other device to your connected TV." property=og:description><meta content="Shaleen Jain - DLNA/UPNP casting support in VLC - Part 2" name=twitter:title><meta content="Shaleen Jain - DLNA/UPNP casting support in VLC - Part 2" property=og:title><meta content="https://shaleenjain.com/blog/vlc-dlna-support-2/vlc-dlna-discover-clip.jpg?h=29ea4a05fdb4404f954d" property=og:image><meta content="https://shaleenjain.com/blog/vlc-dlna-support-2/vlc-dlna-discover-clip.jpg?h=29ea4a05fdb4404f954d" property=twitter:image><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/manifest.json rel=manifest><link href=/icons/safari-pinned-tab.svg rel=mask-icon><link rel="shortcut icon" href=/icons/favicon.ico><meta content=/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><style>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background-color:#0000}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template,[hidden]{display:none}html{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*,:before,:after{box-sizing:inherit}.image-row{flex-flow:wrap;align-items:center;padding:0 4px;display:flex}.image-column{border-radius:8px;flex:50%;width:100%;max-width:50%;height:auto;padding:0 4px}@media screen and (width<=42em){.image-column{flex:100%;max-width:100%}}.text-center{text-align:center}.text-right{text-align:right}.fa-social-icons{margin-top:-1rem;font-size:2rem}.fa-social-icons a{border:0;margin-right:.1rem}.fa-social-icons a:last-child{margin-right:0}.masthead,.content,.footer{max-width:42em;margin-left:auto;margin-right:auto}.masthead:after,.post:after,.related:after,.recent:after,.page:after,.comments:after,.index:after{content:"";background-color:#c4c4c4;width:150px;height:1px;margin:2rem auto;display:block}.related .related-title,.related .recent-title,.recent .related-title,.recent .recent-title{margin-top:0}.masthead{text-align:right;margin-bottom:2rem;padding-top:1rem}.masthead a{color:#111}.masthead .masthead-title{float:left;margin:0;padding:0}.masthead .masthead-title a{border:0;text-decoration:none}.masthead .masthead-nav{margin-bottom:0;padding-left:0;display:inline-block}.masthead .masthead-nav a{border:0;text-decoration:none}.masthead .masthead-nav a+a{margin-left:.6rem}.footer{text-align:center;margin-bottom:1rem}.footer a[rel=license]:first-child{border:0;margin:0;padding:0;text-decoration:none;display:inline-block}.footer .icon-square{color:#0000}.footer .icon-square:hover{color:#252525}.footer .fa-stack-1x{color:#000}.footer p>span{font-size:110%}.footer p>span a{border:0;padding:2px}.footer p>span i:hover{color:#fff}.footer p p:last-child{margin-bottom:0}.posts{padding-bottom:1rem}.posts .posts-item{margin-bottom:1rem}@media (width>=42em){.posts .posts-item{margin-bottom:.2rem}}.posts a{border:0}.posts time{color:#848484;display:block}@media (width>=42em){.posts time{float:right;margin-top:2px}}.next,.previous{font-size:20px;font-weight:600;transition:transform .3s ease-out}.next{float:right}.next:hover{transform:translate(4px)}.previous{float:left}.previous:hover{transform:translate(-4px)}html,body{margin:0}html{font-family:Lora,"sans-serif";font-size:20px;line-height:1.6}@media (width>=42em){html{font-size:22px}}body{color:#444;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;background-color:#fff;padding:2rem 1.5rem}a{color:#4d8b00;border-bottom:1px solid #4d8b00;text-decoration:none}a:hover,a:focus{color:#fff;background-color:#4d8b00}a strong{color:inherit}img{border-radius:5px;max-width:100%;margin:0 0 1rem;display:block}table{border-collapse:collapse;border:1px solid #c4c4c4;width:100%;margin-bottom:1rem;font-size:85%}.js-file-line-container td{border:none}td,th{border:1px solid #c4c4c4;padding:.25rem .5rem}th{text-align:left}tbody tr:nth-child(2n) td,tbody tr:nth-child(2n) th{background-color:#fff}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#fafafa}</style><style>@font-face{font-family:Lora;font-style:italic;font-weight:400;font-display:swap;src:url(/fonts/0QI8MX1D_JOuMw_hLdO6T2wV9KnW-MoFoq92nA.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Lora;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/0QI6MX1D_JOuGQbT0gvTJPa787weuxJBkq0.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Lora;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/0QI6MX1D_JOuGQbT0gvTJPa787z5vBJBkq0.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><body><link href=/style.css rel=stylesheet><style>#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
	#mc_embed_signup form {display:block; position:relative; text-align:left;}
	#mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
	#mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
	#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
	#mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
	#mc_embed_signup input:focus {border-color:#333;}
	#mc_embed_signup .button {clear:both; background-color: #aaa; border: 0 none; border-radius:4px; transition: all 0.23s ease-in-out 0s; color: #FFFFFF; cursor: pointer; display: inline-block; font-size:15px; font-weight: normal; height: 32px; line-height: 32px; margin: 0 5px 10px 0; padding: 0 22px; text-align: center; text-decoration: none; vertical-align: top; white-space: nowrap; width: auto;}
	#mc_embed_signup .button:hover {background-color:#777;}
	#mc_embed_signup .small-meta {font-size: 11px;}
	#mc_embed_signup .nowrap {white-space:nowrap;}

	#mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding: 0.5%; min-height:50px;}
	#mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
	* html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
	#mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
	#mc_embed_signup .mc-field-group input {display:inline; width:100%; padding:8px 0; text-indent:2%;}
	#mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}

	#mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
	#mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
	#mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
	#mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
	#mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

	#mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
	#mc_embed_signup .mce-submit {padding: 0.5%;}
	#mc_embed_signup_scroll {display: flex; justify-items; space-around;}

	#mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
	#mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
	#mc_embed_signup .mc-field-group.input-group label {display:inline;}
	#mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

	#mc_embed_signup div#mce-responses {clear: both;}
	#mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
	#mc_embed_signup #mce-error-response {display:none;}
	#mc_embed_signup #mce-success-response {color:#529214; display:none;}
	#mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}

	#mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
	#mc_embed_signup #num-subscribers {font-size:1.1em;}
	#mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

	#mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:5px 10px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
	#mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */</style><header class=masthead><h3 class=masthead-title><a href=/>Shaleen Jain</a></h3><nav class=masthead-nav><a class=nav-item href=/blog>Blog</a></nav></header><main class=content><article class=post><header class=post-header><time class=post-date datetime=2019-01-12> 12 Jan 2019 </time><small> Â· <span title="Estimated read time" class=reading-time> 3 min read </span> </small><div style=float:right></div><h1 class=post-title>DLNA/UPNP casting support in VLC - Part 2</h1></header><p>DLNA renderers, mainly TVâ€™s are DLNA certified devices that are able to play any media from the local network and is built upon the UPnP A/V Architecture technology. This allows you to cast any video or audio from any other device to your connected TV.</p><span id=continue-reading></span><details id=toc-inline open><summary><b>Table of Contents</b></summary> <ul><li><a href=#discoverying-devices>Discoverying Devices</a><li><a href=#casting-to-the-device>Casting to the Device</a><li><a href=#device-media-formats>Device Media Formats</a><li><a href=#future>Future</a> <ul><li><a href=#demux-filter>Demux Filter</a><li><a href=#dlna-v1-5>DLNA v1.5</a></ul><li><a href=#code>Code</a><li><a href=#release>Release</a></ul></details><h2 id=discoverying-devices><a aria-label="Anchor link for: discoverying-devices" class=zola-anchor href=#discoverying-devices>ðŸ”—</a> Discoverying Devices</h2><p>The next step in adding DLNA support was adding a <code>renderer_discovery</code> module responsible for searching and adding devices that are Media Renderers i.e. capable of playing a video/audio stream that we may cast to it.<p>To do that we use the <code>libupnp</code> library to find the devices and call the VLC <code>vlc_renderer_item_new()</code> function for each device with relevant information so that they can be show to the user in a menu and then select which device to cast to.<p>Someone had partially done this before me but not yet merged, partly due to the problem I explained and solved in the previous post of this series. After adapting that patch we were now able to discover and list any DLNA renderers available on the same network.</p><img src=/processed_images/vlc-dlna-discover-clip.ac87b31d7a0e6ba3.jpg><h2 id=casting-to-the-device><a aria-label="Anchor link for: casting-to-the-device" class=zola-anchor href=#casting-to-the-device>ðŸ”—</a> Casting to the Device</h2><p>Now to actually be able to cast to a device we need to create a <code>stream_out</code> VLC module with http as the transport method. Much of that logic is similar to how chromecast creates a <code>stream_out</code> except that we use UPnP Actions represented as SOAP requests instead of the horror that is Google's protobuf to talk to the device.<p>After going through the DLNA guidelines and the UPnP AV spec, I added functions that called the actions required to talk to any DLNA device implementing the AVTransport Service and we had a working implementation of VLC acting as a UPnP control point that was able to cast to almost all DLNA renderers.<p>I say almost all because legacy DLNA renderers (below DLNA v1.5) and renderers not implementing the <code>AVTransport::SetAVTransportURI</code> action are not yet supported.<h2 id=device-media-formats><a aria-label="Anchor link for: device-media-formats" class=zola-anchor href=#device-media-formats>ðŸ”—</a> Device Media Formats</h2><p>Having a working tranport is still half of story, another important aspect of casting is to make sure the device is able to decode the file that you are trying to play. To solve this I had to call the <code>ConnectionManager::GetProtocolInfo()</code> action to get a CSV list of all the Media formats supported by the device, maintain a manual list of all possible Media format profiles defined by DLNA.org and others within VLC, find a profile that best describes the file the user is trying to play and then compare that profile to the device profiles to make sure if it can play it.<p>And if a device does not support the profile of the file we are trying to play then we transcode the file to a format that the device supports, on the fly, and stream it to the device.<p>As you can imagine this is quite an involved process more so with the transcoding since we had to make sure the transcoding will work in a reasonable amount of time on every platform VLC is run i.e. on Linux, Windows, MacOS, iOS and android each of which has different platform APIs and SoCs/Processors and hence took up majority of my time.<h2 id=future><a aria-label="Anchor link for: future" class=zola-anchor href=#future>ðŸ”—</a> Future</h2><p>There are still a few things left to add for a seamless experience with DLNA casting in VLC.<h3 id=demux-filter><a aria-label="Anchor link for: demux-filter" class=zola-anchor href=#demux-filter>ðŸ”—</a> Demux Filter</h3><p>Due to the nature of VLC's module system and its media processing pipeline, <code>stream_out</code> modules cannot control the rate at which a video is decoded and sent out for display. So things like pause, fast-forward and track sync between VLC and the DLNA device doesn't work properly yet.<p>There's a workaround to use <code>demux_filter</code> to control the pacing between the <code>demux</code> and the <code>access_out</code> module using an IPC mechanisuim between the two modules, even though they both run in the same process.<h3 id=dlna-v1-5><a aria-label="Anchor link for: dlna-v1-5" class=zola-anchor href=#dlna-v1-5>ðŸ”—</a> DLNA v1.5</h3><p>DLNA v1.5 is a legacy DLNA spec version that has very strict requirements and cannot easily play any supported media from the cloud. These requirements were removed in later versions of the DLNA spec.<p>To support DLNA v1.5 Media Renderers (many old Samsung and Sony TVs) we need a DLNA v1.5 compliant HTTP server with the appropriate DLNA specific headers. This is related to the <code>demux_filter</code> and can be easily implemented once we have that.<h2 id=code><a aria-label="Anchor link for: code" class=zola-anchor href=#code>ðŸ”—</a> Code</h2><p>The merged commits can be found here:<ol><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=0d89fe3fd7d27d7c3f349bb46a915dbae65c02f8" rel=external>upnp: add renderer discoverer</a><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=ec61edc0d0292ab37bb1dbafb23a8aed49e966bb" rel=external>chromecast: refactor out encoder option functions</a><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=7da4464ca093604f2a507e3b39330fed17838e62" rel=external>dlna: add a DLNA stream out</a><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=0a34ce334a7c8b2d3926148be30f5b69fd253e41" rel=external>dlna: add GetProtocolInfo action</a><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=b671d3b3270790fd11aa3bc76cfe42f75ca25c52" rel=external>dlna: add PrepareForConnection action</a></ol><h2 id=release><a aria-label="Anchor link for: release" class=zola-anchor href=#release>ðŸ”—</a> Release</h2><p>You can start casting to DLNA compliant devices using the next VLC 4.0 release or the latest nightly<sup class=footnote-reference><a href=#fn-warn>1</a></sup> releases for Windows, MacOS and Linux.<div class=footnote-definition id=fn-warn><sup class=footnote-definition-label>1</sup><p>Warning: with any nightly release there may still be bugs that are not yet fixed.</div></article><div>Liked this article? Share this with others</div><p>Got any questions or comments? Drop me a message on <a href=https://twitter.com/shalzzj rel=nofollow>Twitter @shalzzj</a><div>Sign up for my newsletter to be the first to know about a new post <div id=mc_embed_signup><form action="https://shaleenjain.us1.list-manage.com/subscribe/post?u=1eaa5ecf0b59e6a364a3c9c1a&id=dbd95a64e5" class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate target=_blank><div id=mc_embed_signup_scroll><div class=mc-field-group><input class="required email plausible-event-name=EmailInput" placeholder="Email Address" id=mce-EMAIL name=EMAIL type=email></div><div aria-hidden=true style=position:absolute;left:-5000px><input name=b_1eaa5ecf0b59e6a364a3c9c1a_dbd95a64e5 tabindex=-1></div><div class=mce-submit><input class="button plausible-event-name=Subscribe" id=mc-embedded-subscribe name=subscribe type=submit value=Subscribe></div></div><div id=mce-responses><div class=response id=mce-error-response></div><div class=response id=mce-success-response></div></div></form></div><script defer src=//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js></script><script>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div></main><footer class=footer><p><small> This work is licensed under the <a href=http://creativecommons.org/licenses/by-sa/4.0/ rel=license> CC BY-SA 4.0</a> license. <br> <a href=/atom.xml>RSS Feed</a> â€” <a href=/donate>Donate</a> </small></footer><script async src=https://plausible.8bitlabs.dev/js/pa-MDCY-wYsAIc-90RWH7tfO.js></script><script>window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()</script>