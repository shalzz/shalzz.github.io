<!doctype html><html lang=en><head><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content="interest-cohort=()" http-equiv=Permissions-Policy><title>
  Shaleen Jain - Fuzzing libVLC - Final Report
</title><meta content="
Update: My fuzz targets have been merged into the VLC mainline tree by commits 74e7bd2, b83e9f2.


Introduction to my GSoC project here

Majority of the parsing code of VLC has been successfully setup to be fuzzed by:

The demux fuzz target which creates an input stream from the fuzzed input provided by libfuzzer,
probes and loads an appropriate demux module and demultiplexes the input into the various output
elementary streams, minimally handling all the ES callbacks and calling various demux_Control's to
increase code coverage.
" name=description><meta content="libfuzzer, libvlc, vlc, fuzzing, gsoc-2017, gsoc" name=keywords><meta content="Shaleen Jain" name=author><link href=https://twitter.com/shalzzj rel=author><link href=https://shaleenjain.com/blog/fuzzing-vlc-4/ rel=canonical><link href=https://shaleenjain.com/atom.xml rel=alternate title=RSS type=application/atom+xml><meta content=@shalzzj name=twitter:site><meta content=@shalzzj name=twitter:creator><meta content=article property=og:type><meta content=https://shaleenjain.com/blog/fuzzing-vlc-4/ property=og:url><meta content="
Update: My fuzz targets have been merged into the VLC mainline tree by commits 74e7bd2, b83e9f2.


Introduction to my GSoC project here

Majority of the parsing code of VLC has been successfully setup to be fuzzed by:

The demux fuzz target which creates an input stream from the fuzzed input provided by libfuzzer,
probes and loads an appropriate demux module and demultiplexes the input into the various output
elementary streams, minimally handling all the ES callbacks and calling various demux_Control's to
increase code coverage.
" property=og:description><meta content="Shaleen Jain - Fuzzing libVLC - Final Report" name=twitter:title><meta content="Shaleen Jain - Fuzzing libVLC - Final Report" property=og:title><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/manifest.json rel=manifest><link href=/icons/safari-pinned-tab.svg rel=mask-icon><link rel="shortcut icon" href=/icons/favicon.ico><meta content=/icons/browserconfig.xml name=msapplication-config><meta content=#ffffff name=theme-color><style>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background-color:#0000}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template,[hidden]{display:none}html{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*,:before,:after{box-sizing:inherit}.image-row{flex-flow:wrap;align-items:center;padding:0 4px;display:flex}.image-column{border-radius:8px;flex:50%;width:100%;max-width:50%;height:auto;padding:0 4px}@media screen and (width<=42em){.image-column{flex:100%;max-width:100%}}.text-center{text-align:center}.text-right{text-align:right}.fa-social-icons{margin-top:-1rem;font-size:2rem}.fa-social-icons a{border:0;margin-right:.1rem}.fa-social-icons a:last-child{margin-right:0}.masthead,.content,.footer{max-width:42em;margin-left:auto;margin-right:auto}.masthead:after,.post:after,.related:after,.recent:after,.page:after,.comments:after,.index:after{content:"";background-color:#c4c4c4;width:150px;height:1px;margin:2rem auto;display:block}.related .related-title,.related .recent-title,.recent .related-title,.recent .recent-title{margin-top:0}.masthead{text-align:right;margin-bottom:2rem;padding-top:1rem}.masthead a{color:#111}.masthead .masthead-title{float:left;margin:0;padding:0}.masthead .masthead-title a{border:0;text-decoration:none}.masthead .masthead-nav{margin-bottom:0;padding-left:0;display:inline-block}.masthead .masthead-nav a{border:0;text-decoration:none}.masthead .masthead-nav a+a{margin-left:.6rem}.footer{text-align:center;margin-bottom:1rem}.footer a[rel=license]:first-child{border:0;margin:0;padding:0;text-decoration:none;display:inline-block}.footer .icon-square{color:#0000}.footer .icon-square:hover{color:#252525}.footer .fa-stack-1x{color:#000}.footer p>span{font-size:110%}.footer p>span a{border:0;padding:2px}.footer p>span i:hover{color:#fff}.footer p p:last-child{margin-bottom:0}.posts{padding-bottom:1rem}.posts .posts-item{margin-bottom:1rem}@media (width>=42em){.posts .posts-item{margin-bottom:.2rem}}.posts a{border:0}.posts time{color:#848484;display:block}@media (width>=42em){.posts time{float:right;margin-top:2px}}.next,.previous{font-size:20px;font-weight:600;transition:transform .3s ease-out}.next{float:right}.next:hover{transform:translate(4px)}.previous{float:left}.previous:hover{transform:translate(-4px)}html,body{margin:0}html{font-family:Lora,"sans-serif";font-size:20px;line-height:1.6}@media (width>=42em){html{font-size:22px}}body{color:#444;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;background-color:#fff;padding:2rem 1.5rem}a{color:#4d8b00;border-bottom:1px solid #4d8b00;text-decoration:none}a:hover,a:focus{color:#fff;background-color:#4d8b00}a strong{color:inherit}img{border-radius:5px;max-width:100%;margin:0 0 1rem;display:block}table{border-collapse:collapse;border:1px solid #c4c4c4;width:100%;margin-bottom:1rem;font-size:85%}.js-file-line-container td{border:none}td,th{border:1px solid #c4c4c4;padding:.25rem .5rem}th{text-align:left}tbody tr:nth-child(2n) td,tbody tr:nth-child(2n) th{background-color:#fff}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#fafafa}</style><style>@font-face{font-family:Lora;font-style:italic;font-weight:400;font-display:swap;src:url(/fonts/0QI8MX1D_JOuMw_hLdO6T2wV9KnW-MoFoq92nA.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Lora;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/0QI6MX1D_JOuGQbT0gvTJPa787weuxJBkq0.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Lora;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/0QI6MX1D_JOuGQbT0gvTJPa787z5vBJBkq0.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><body><link href=/style.css rel=stylesheet><style>#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
	#mc_embed_signup form {display:block; position:relative; text-align:left;}
	#mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
	#mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
	#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
	#mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
	#mc_embed_signup input:focus {border-color:#333;}
	#mc_embed_signup .button {clear:both; background-color: #aaa; border: 0 none; border-radius:4px; transition: all 0.23s ease-in-out 0s; color: #FFFFFF; cursor: pointer; display: inline-block; font-size:15px; font-weight: normal; height: 32px; line-height: 32px; margin: 0 5px 10px 0; padding: 0 22px; text-align: center; text-decoration: none; vertical-align: top; white-space: nowrap; width: auto;}
	#mc_embed_signup .button:hover {background-color:#777;}
	#mc_embed_signup .small-meta {font-size: 11px;}
	#mc_embed_signup .nowrap {white-space:nowrap;}

	#mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding: 0.5%; min-height:50px;}
	#mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
	* html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
	#mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
	#mc_embed_signup .mc-field-group input {display:inline; width:100%; padding:8px 0; text-indent:2%;}
	#mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}

	#mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
	#mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
	#mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
	#mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
	#mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

	#mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
	#mc_embed_signup .mce-submit {padding: 0.5%;}
	#mc_embed_signup_scroll {display: flex; justify-items; space-around;}

	#mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
	#mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
	#mc_embed_signup .mc-field-group.input-group label {display:inline;}
	#mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

	#mc_embed_signup div#mce-responses {clear: both;}
	#mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
	#mc_embed_signup #mce-error-response {display:none;}
	#mc_embed_signup #mce-success-response {color:#529214; display:none;}
	#mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}

	#mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
	#mc_embed_signup #num-subscribers {font-size:1.1em;}
	#mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

	#mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:5px 10px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
	#mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}
	/* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */</style><header class=masthead><h3 class=masthead-title><a href=/>Shaleen Jain</a></h3><nav class=masthead-nav><a class=nav-item href=/blog>Blog</a></nav></header><main class=content><article class=post><header class=post-header><time class=post-date datetime=2017-08-28> 28 Aug 2017 </time><small> Â· <span title="Estimated read time" class=reading-time> 3 min read </span> </small><div style=float:right></div><h1 class=post-title>Fuzzing libVLC - Final Report</h1></header><blockquote><p>Update: My fuzz targets have been merged into the VLC mainline tree by commits <a href=https://github.com/videolan/vlc/commit/74e7bd240d5b239d0eeb3b67a7511b8b83cb6694 rel=external>74e7bd2</a>, <a href=https://github.com/videolan/vlc/commit/b83e9fe08d12ae798390bfa64c08096801fcd8c1 rel=external>b83e9f2</a>.</blockquote><blockquote><p><em>Introduction to my GSoC project <a href=https://shaleenjain.com/blog/why-fuzz-vlc/>here</a></em></blockquote><p>Majority of the parsing code of VLC has been successfully setup to be fuzzed by:<ul><li>The demux fuzz target which creates an input stream from the fuzzed input provided by libfuzzer, probes and loads an appropriate demux module and demultiplexes the input into the various output elementary streams, minimally handling all the ES callbacks and calling various demux_Control's to increase code coverage.</ul><span id=continue-reading></span><ul><li>The decoder fuzz target by creating a packetizer and a decoder instance while ignoring the stream out, packetizing the input block and then proceeding to decode the various packetized blocks. Hardware decoding as been disabled, so that we only test the codecs included in VLC and the module itself though many of the codecs are provided by 3rd party libraries.</ul><p>These two fuzz targets cover over 35 demux modules and 64 different codec modules or 163k lines of code which is 20.7% of the VLC code base.<p>Actual code coverage as measured by libFuzzer would be different if not more but since as of now VLC is unable to build with the clang linker, I do not have that coverage information.<h4 id=some-additional-challenges-and-features-were><a aria-label="Anchor link for: some-additional-challenges-and-features-were" class=zola-anchor href=#some-additional-challenges-and-features-were>ðŸ”—</a> Some additional challenges and features were</h4><ul><li>adding first class support for sanitizers in the VLC build system. You can now compile VLC with sanitizers just by using the --with-sanitizer switch. These changes are merged into the mainline, more details <a href="http://git.videolan.org/?p=vlc.git;a=commit;h=2bc9957c615d9505f89d88511a0d6ef3889b392b" rel=external>here</a><li>finding and adding sample inputs of various video file formats and containers and elementary streams encoded with different codecs for the fuzz targets<li>Creating a dictionary of various tokens and FourCC's used to separate the various chunks and atoms in container formats.</ul><h4 id=code><a aria-label="Anchor link for: code" class=zola-anchor href=#code>ðŸ”—</a> Code</h4><p>Since VideoLAN has still not decided whether to use Google's OSS-fuzz or agree to their terms and doesn't want this code to be misused by hackers, they have decided not to keep this in the mainline tree to minimize exposure.<p>And so here are all of my out of tree patches:<ul><li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=57949e7a9b9da4d9130db0359199b16fca1b061c" rel=external>57949e7a9b9da4d9130db0359199b16fca1b061c</a> (merged)<li><a href="http://git.videolan.org/?p=vlc.git;a=commit;h=2bc9957c615d9505f89d88511a0d6ef3889b392b" rel=external>2bc9957c615d9505f89d88511a0d6ef3889b392b</a> (merged)<li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/583b4b6ed83e64cf52ab75d0d5163a360d626ec6 rel=external>583b4b6ed83e64cf52ab75d0d5163a360d626ec6</a><li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/89cc31145c47cb3769d9c3258a1d2baa4d563c37 rel=external>89cc31145c47cb3769d9c3258a1d2baa4d563c37</a><li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/c893f6597efc23cf234af12f09d05510c0c744c3 rel=external>c893f6597efc23cf234af12f09d05510c0c744c3</a><li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/ef80ea254005e84589dd310abe87ce0d3d2a0c90 rel=external>ef80ea254005e84589dd310abe87ce0d3d2a0c90</a><li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/f03556549bd074f724d47901bd58d730d12998d6 rel=external>f03556549bd074f724d47901bd58d730d12998d6</a><li><a href=https://code.videolan.org/GSoC2017/shalzz/vlc/commit/23f2e30f4a6241bc3476414ac187d1e7e8169dd3 rel=external>23f2e30f4a6241bc3476414ac187d1e7e8169dd3</a></ul><p>My main work repo has been <a href=https://code.videolan.org/GSoC2017/shalzz/vlc/ rel=external>code.videolan.org/GSoC2017/shalzz/vlc</a> with all my commit history in the master branch and final patches in the <a href=https://code.videolan.org/GSoC2017/shalzz/vlc/tree/release rel=external>release</a> branch. There is a clone of the repo on <a href=https://github.com/Shalzz/vlc rel=external>github</a> as well.<p>To run the code,<ol><li>clone the repo and build vlc instrumented with one or more of the sanitizers using the new <code>--with-sanitizer=</code> switch.<li>Get and build libFuzzer by changing into the test/fuzz/ directory and using the <code>./build-libfuzzer.sh</code> script<li>Build the fuzz target binaries by running <code>make check</code>.<li>Run the fuzz targets manually or by using the <code>./run-fuzzer.sh</code> helper script</ol><h4 id=bug-trophy><a aria-label="Anchor link for: bug-trophy" class=zola-anchor href=#bug-trophy>ðŸ”—</a> Bug Trophy</h4><p>As for the number of bugs found by the initial fuzzing done on my small laptop there have been quite a few, all of which have been fixed, by me and other VLC developers. Few of them:<ul><li><a href=https://github.com/videolan/vlc/commit/6c947b775d4d6c6ed07ebde140bddd3a2007b41a rel=external>6c947b775d4d6c6ed07ebde140bddd3a2007b41a</a><li><a href=https://github.com/videolan/vlc/commit/a672ea060efbb5898e1d80327f5909a43e8b57d8 rel=external>a672ea060efbb5898e1d80327f5909a43e8b57d8</a><li><a href=https://github.com/videolan/vlc/commit/b2fb79e3201c5ce77a176b52936835ce195aa986 rel=external>b2fb79e3201c5ce77a176b52936835ce195aa986</a><li><a href=https://github.com/videolan/vlc/commit/1de4047a25cd336d1539ea0867c29180928dd230 rel=external>1de4047a25cd336d1539ea0867c29180928dd230</a><li><a href=https://github.com/videolan/vlc/commit/7033852e1a8292734e1d5800bec864bb5fb24c30 rel=external>7033852e1a8292734e1d5800bec864bb5fb24c30</a><li><a href=https://github.com/videolan/vlc/commit/3266d738e906b38b53f7936f58565441d0652713 rel=external>3266d738e906b38b53f7936f58565441d0652713</a><li><a href=https://github.com/videolan/vlc/commit/4b76784615f74254a7b66e34ff78393b44af2ed5 rel=external>4b76784615f74254a7b66e34ff78393b44af2ed5</a><li><a href=https://github.com/videolan/vlc/commit/7eea089393d6fc1de3436b4d486a466d14566a04 rel=external>7eea089393d6fc1de3436b4d486a466d14566a04</a></ul><h4 id=continuous-fuzzing><a aria-label="Anchor link for: continuous-fuzzing" class=zola-anchor href=#continuous-fuzzing>ðŸ”—</a> Continuous Fuzzing</h4><p>One thing that's left to do is setting up of a continuous fuzzing server. Since OSS-fuzz is not in the picture right now, that is something VLC devs will have to do on their own infrastructure.</article><div>Liked this article? Share this with others</div><p>Got any questions or comments? Drop me a message on <a href=https://twitter.com/shalzzj rel=nofollow>Twitter @shalzzj</a><div>Sign up for my newsletter to be the first to know about a new post <div id=mc_embed_signup><form action="https://shaleenjain.us1.list-manage.com/subscribe/post?u=1eaa5ecf0b59e6a364a3c9c1a&id=dbd95a64e5" class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate target=_blank><div id=mc_embed_signup_scroll><div class=mc-field-group><input class="required email plausible-event-name=EmailInput" placeholder="Email Address" id=mce-EMAIL name=EMAIL type=email></div><div aria-hidden=true style=position:absolute;left:-5000px><input name=b_1eaa5ecf0b59e6a364a3c9c1a_dbd95a64e5 tabindex=-1></div><div class=mce-submit><input class="button plausible-event-name=Subscribe" id=mc-embedded-subscribe name=subscribe type=submit value=Subscribe></div></div><div id=mce-responses><div class=response id=mce-error-response></div><div class=response id=mce-success-response></div></div></form></div><script defer src=//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js></script><script>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div></main><footer class=footer><p><small> This work is licensed under the <a href=http://creativecommons.org/licenses/by-sa/4.0/ rel=license> CC BY-SA 4.0</a> license. <br> <a href=/atom.xml>RSS Feed</a> â€” <a href=/donate>Donate</a> </small></footer><script async src=https://plausible.8bitlabs.dev/js/pa-MDCY-wYsAIc-90RWH7tfO.js></script><script>window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()</script>